---
title: Віддалене керування
icon: material/remote-desktop
---

# Віддалене керування по протоколу Modbus RTU/TCP

Для взаємодії перетворювача із системами верхнього рівня передбачається передавання інформації по витій парі RS-485 або мережі стільникового зв'язку GSM. На програмному рівні замовник може використовувати Modbus RTU або Modbus TCP/IP протоколи.

При побудові мережі використовується принцип організації ведучий-ведений (master-slave). 
В мережі повинен бути тільки один ведучий і може бути до 247 ведених. Як ведучий використовується ПК або ПЛК, а як ведені – перетворювачі ІПКЗ. 
Ініціатором циклів обміну повинен виступати тільки ведучий. Запити ведучого індивідуальні, які адресуються конкретному перетворювачу. Ведені здійснюють передачу даних, відповідаючи на індивідуальні запити ведучого. 
При виявленні помилок при отриманні запитів або неможливості виконання отриманої команди, ведений генерує повідомлення про помилку або не відповідає.
 
## Мережа RS-485 та Modbus RTU протокол { #rs485--modbus data-toc-label='Modbus RTU протокол' }

Для з’єднання на фізичному рівні використовуються мережа RS-485.

- Для стабільності і безпеки зв'язку використовується ізольований прийомопередавач сигналів з ізольованим джерелом живлення.
- Рівні сигналів відповідають стандарту EIA/TIA RS-485, навантаження прийомопередавача 1/8 UL.
- Для узгодження та захисного зміщення сигналів RS-485 передбачені один термінальний та два підтягуючі резистори. Їх можна підключити або відключити через DIP перемикачі. Заводське положення термінального та підтягуючих резисторів - відключені.
- Використовується напівдуплексний режим.
- Формат кадру обміну даними: 8N1, 1 старт-біт, 8 біт інформації, 1 стоп-біт, без контролю чіткості.
- Бітрейт в мережі RS-485 може бути встановлений 4800, 9600, 19200, 38400, 57600 або 115200 baud. Заводське значення 9600 baud.
- ModBus ID адреса сервера кожного перетворювача в одній мережі RS-485 має бути унікальна й встановлена індивідуально в діапазоні від 1 до 247. Заводське значення 1.
- Програмний рівень передачі пакетів даних відповідає протоколу Modbus RTU.

!!! info "Варіанти налаштування бітрейта та Modbus ID адреси для мережі RS-485"

    - Вручну використовуючи ручку енкодера та дисплей.
    - За домогогою WEB інтерфейсу.
    - Записом в відповідні регістри Modbus через мережу GSM.

## Мережа GSM та Modbus TCP/IP протокол { #gsm-modbus data-toc-label='Modbus TCP/IP протокол' }

Для з’єднання на фізичному рівні використовуються мережа GSM.

- Налаштування GSM модему та Modbus TCP/IP сервера проводиться відповідно до Додатка 2.
- На відміну від мережі RS-485 ModBus ID адреса сервера перетворювача в мережі GSM непотрібна унікальна та може бути довільною від 1 до 247. Але налаштування можливе. Заводське значення 1.
- Програмний рівень передачі пакетів даних відповідає протоколу Modbus TCP/IP.

!!! info "Варіанти налаштування Modbus ID адреси для мережі GSM"

    - Вручну використовуючи ручку енкодера та дисплей.
    - За домогогою WEB інтерфейсу.
    - Записом в відповідні регістри Modbus через мережу RS-485.

## Детальний опис регістрів ModBus RTU/TCP { #registers-modbus data-toc-label='Опис регістрів ModBus RTU/TCP' }

Числа які починаються з `0x` мають шістнадцятковий формат, всі інші десятковий формат. 

Для читання даних та керування ІПКЗ використовується набір регістрів і функції читання регістрів 3 (0x03) та 4 (0x04), запису в один регістр 6 (0x06), запис в декілька регістрів 16 (0x10). Інші функції ігноруються.

- Для читання значень з одного або/та декількох регістрів потрібно використовувати функцію 0x03 (Read Holding Registers) або/та 0x04 (Read Input Registers).
- Для запису в один регістр потрібно використовувати функцію 0x06 (Write Single Register).
- Для запису в один або декілька регістрів потрібно використовувати функцію 0x10 (Write Multiple regiters).

Перетворювачі передають числа `int16_t`, `int32_t`, `uint32_t` та рядки `string`. Протокол обміну ModBus RTU/TCP не має засобів позначення типу переданих даних. Відповідальність по визначенню типу лягає на програмне забезпечення верхнього рівня. ModBus RTU/TCP використовує big-endian представлення для адреси та даних. Це означає, що коли передається числова величина, більша за один байт, першим надсилається старший байт. Нижче представлено приклади передачі , числа в прикладах у шістнадцятковому форматі.

- При передачі `int16_t` числа `0x0102` першим байтом буде надіслано `0x01`, другим `0х02`. 
- При передачі `int32_t` числа `0x01020304` першим байтом буде надіслано `0x01`, другим `0х02`, третім `0х03`, четвертим `0х04`.

### Читання основних параметрів перетворювача  { #registers-read-ipkz data-toc-label='Читання параметрів перетворювача' }

Читання функція 03 (0x03) Read Holding Registers та/або 04 (0x04) Read Input Registers.

| **Адреса<br>регістрів** | **Функціонал** | **Доступ** | **Діапазон та формат<br>даних в перетворювачі** | **Точність** | **Діапазон та формат<br>даних в регістрах** | **Тип даних** |
|---|---|---|---|---|---|---|
|Стан перетворювача| &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
|0 | Стан перетворювача ІПКЗ | Тільки читання (R) | Число від 0 до 5 | - | Число від 0 до 5<br>0 : Стан в нормі;<br>1 : Немає мережі 230 В;<br>2 : Помилка силового блоку;<br>3 : Сигналізація про високу, понад 75&deg;C, внутрішню температуру силового блоку;<br>4 : Спрацював захист від перенапруги;<br>5 : Спрацював захист від перевантаження;| `int16_t` |
| Основні показники |  &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| 1 | Режим роботи | Тільки читання (R) | Від 0 до 3 | - | Число від 0 до 3<br>0 : Вихід вимкнений;<br>1 : Стабілізація напруги;<br>2 : Стабілізація струму;<br>3 : Стабілізація потенціалу; |  `int16_t` |
| 2 | Вихідна напруга, V*10 | Тільки читання (R) | Від 0 до 100.0 V | 0.1 V | Число від 0 до 1000 | `int16_t` |
| 3 | Вихідний струм, A*10 | Тільки читання (R) | Від 0 до 100.0 A | 0.1 A | Число від 0 до 1000 |  `int16_t` |
| 4 | Захисний потенціал з омічною складовою, V*100 | Тільки читання (R) | Від -10.00 до +5.00 V | 0.01 V | Число від -1000 до +500 | `int16_t` |
| Живлення | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| 5 | Напруга мережі живлення, V | Тільки читання (R) | Від 0 до 300 V | 1 V | Число від 0 до 300 | `int16_t` |
| 6, 7 | Показник лічильника електроенергії, kW&sdot;h *10 | Тільки читання (R) | Від 0 до 999999.9 kW&sdot;h | 0.1 kW&sdot;h | Число від 0 до 9999999 | `int32_t` |
| 8 | Рівень заряду акумулятора, % | Тільки читання (R) | Від 0 до 100 % | 1% | Число від 0 до 100 | `int16_t` |
| Температурні показники | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| 9 | Температура в шафі, &deg;C | Тільки читання (R) | Від -50 до +120 &deg;C | 1 &deg;C | Число від -50 до +120 | `int16_t` |
| 10 | Температура силового блоку, &deg;C | Тільки читання (R) | Від -50 до +120 &deg;C | 1 &deg;C | Число від -50 до +120 | `int16_t` |
| Тривалість експлуатації | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| 11, 12 | Час напрацювання, годин | Тільки читання (R) | Від 0 до 999999 годин | 1 година | Число від 0 до 999999 | `int32_t` |
| 13, 14 | Час дії захисту, годин | Тільки читання (R) | Від 0 до 999999 годин | 1 година | Число від 0 до 999999 | `int32_t` | 
| Різне | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| 15, 16 | Дата та час годинника реального часу перетворювача в форматі Unix Timestamp, сек | Тільки читання (R) | Від 1735682400 до 4294967295 сек | 1 сек | Число від 1735682400 до 4294967295 | `uint32_t` | 
| 17, 18, 19, 20, 21 |Зарезервовано | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| &nbsp; |Стан дверцят шафи ІПКЗ|Тільки читання (R)|Число від 0 до 1|-|Число від 0 до 1<br>0 : Дверцята закриті;<br>1 : Дверцята відкриті;| `int16_t` |
| &nbsp; |Стан зовнішніх дверей|Тільки читання (R)|Число від 0 до 1|-|Число від 0 до 1<br>0 : Двері закриті;<br>1 : Двері відкриті| `int16_t` |
| &nbsp; |Стан мережі 230V|Тільки читання (R)|Число від 0 до 1|-|Число від 0 до 1<br>0 : Мережі немає;<br>1 : Мережа є;| `int16_t` |
| &nbsp; |Стан ланцюгів навантаження|Тільки читання (R)|Число від 0 до 2|&shy;-|Число від 0 до 2<br>0 : Норма;<br>1 : Обрив;<br>2 : Коротке замикання;| `int16_t` |
| &nbsp; |Стан вимірювальних ланцюгів від електрода порівняння|Тільки читання (R)|Число від 0 до 2|-|Число від 0 до 2<br>0 : Норма;<br>1 : Обрив;<br>2 : Коротке замикання;| `int16_t` |

### Управління параметрами перетворювача { #registers-control-ipkz data-toc-label='Управління параметрами перетворювача' }

Читання функція 03 (0x03) Read Holding Registers та/або 04 (0x04) Read Input Registers, запис функція 06 (0x06) Write Single Register та/або 16 (0x10) Write Multiple registers.

| **Адреса<br>регістрів** | **Функціонал** | **Доступ** | **Діапазон та формат<br>даних в перетворювачі** | **Точність** | **Діапазон та формат<br>даних в регістрах** | **Тип даних** |
|---|---|---|---|---|---|---|
| Встановлення режиму роботи | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| 22 | Керування режимом роботи | Читання та запис (R/W) | Число від 0 до 3 | - |Число від 0 до 3<br>0 : Вимкнути вихід;<br>1 : Режим стабілізації напруги;<br>2 : Режим стабілізації струму;<br>3 : Режим стабілізації потенціалу;| `int16_t` |
| 23 | Уставка вихідної напруги, V*10 | Читання та запис (R/W) | Від 0 до 100.0 V | 0.1 V | Число від 0 до 1000 | `int16_t` |
| 24 | Уставка вихідного струму, А*10 | Читання та запис (R/W) | Від 0 до 100.0 A | 0.1 A | Число від 0 до 1000 | `int16_t` |
| 25 | Уставка захисного потенціалу з омічною складовою, V*100 | Читання та запис (R/W) | Від -10.0 до 0 V | 0.01 V | Число від -1000 до 0 | `int16_t` |
| Обмеження вихідного струму та напруги при аварії | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| 26 | Максмимальний струм при обриві мідносульфатного електрода порівняння, А*10|Читання та запис (R/W) | Від 0 до 100.0 A | 0.1 A | Число від 0 до 1000 | `int16_t` |
| 27 | Максмимальна напруга при обриві ланцюгів навантаження, V*10 | Читання та запис (R/W) | Від 0 до 100.0 V | 0.1 V | Число від 0 до 1000 | `int16_t` |
| Налаштування ПІД регулятора | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |
| 28 | Режим роботи ПІД регулятора | Читання та запис (R/W) | Від 0 до 1 | - | Число від 0 до 1<br>0 : Стандартний режим;<br>1 : Ручний режим;| `int16_t` |
| 29 | Пропорційний коефіцієнт ПІД регулятора для ручного режиму, KP*10 | Читання та запис (R/W)|Від 0.1 до 10.0|0.1 KP|Число від 1 до 100| `int16_t` |
| 30 | Інтегральний коефіцієнт ПІД регулятора для ручного режиму, KI*10 | Читання та запис (R/W)|Від 0.1 до 10.0|0.1 KI|Число від 1 до 100| `int16_t` |
| 31 | Диференціальний коефіцієнт ПІД регулятора для ручного режиму, KD*10 | Читання та запис (R/W)|Від 0.1 до 10.0|0.1 KD|Число від 1 до 100| `int16_t` |
| 32, 33, 34, 35, 36 | Зарезервовано | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |

### Інформація про перетворювач { #registers-about data-toc-label='Інформація про перетворювач' }

Читання функція 03 (0x03) Read Holding Registers та/або 04 (0x04) Read Input Registers.

| **Адреса<br>регістрів** | **Функціонал** | **Доступ** | **Діапазон та формат<br>даних в перетворювачі** | **Точність** | **Діапазон та формат<br>даних в регістрах** | **Тип даних** |
|---|---|---|---|---|---|---|
| 37, 38 | ID номер | Тільки читання (R) | Від 1 до 999999 | 1 | Число від 1 до 999999 | `int32_t` |
| 39 | Серійний номер | Тільки читання (R) | Від 1000 до 9999 | 1 | Число від 1000 до 9999 | `int16_t` |
| 40 | Рік виготовлення, рік | Тільки читання (R) | Від 2025 до 2055 року | 1 рік | Число від 2025 до 2055 | `int16_t` |
| 41 | Номінальна вихідна потужність, W | Тільки читання (R) | Від 0 до 5000 W | 1 W | Число від 0 до 5000 | `int16_t` |
| 42 | Номінальна вихідна напруга, V | Тільки читання (R) | Від 0 до 100 V | 1 V | Число від 0 до 100 | `int16_t` |
| 43 | Номінальний вихідний струм, A | Тільки читання (R) | Від 0 до 100 A | 1 A | Число від 0 до 100 | `int16_t` |
| 44 | Версія апаратного забезпечення | Тільки читання (R) | Від 1.0 до 10.0 | 0.1 | Число від 10 до 100 | `int16_t` |
| 45 | Версія програмного забезпечення | Тільки читання (R) | Від 1.0 до 10.0 | 0.1 | Число від 10 до 100 | `int16_t` |
| 46, 47, 48, 49, 50 | Зарезервовано| &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |


### Управління параметрами ModBus { #registers-control-modbus data-toc-label='Управління параметрами ModBus' }

Читання функція 03 (0x03) Read Holding Registers та/або 04 (0x04) Read Input Registers, запис функція 06 (0x06) Write Single Register та/або 16 (0x10) Write Multiple registers.

| **Адреса<br>регістрів** | **Функціонал** | **Доступ** | **Діапазон значень** | **Точність** | **Діапазон та формат<br>даних в регістрах** | **Тип даних** |
|---|---|---|---|---|---|---|
| 51, 52 | Бітрейт в мережі RS-485, baud | Читання та запис (R/W) | 4800, 9600, 19200, 38400, 57600, 115200 | 1 | Число 4800, 9600, 19200, 38400, 57600, 115200 | `int32_t` |
| 53 | Modbus ID адреса перетворювача в мережі RS-485 | Читання та запис (R/W) | Від 1 до 247 | 1 | Число від 1 до 247 | `int16_t` |
| 54 | Modbus ID адреса перетворювача в мережі GSM | Читання та запис (R/W) | Від 1 до 247 | 1 | Число від 1 до 247 | `int16_t` |
| 55, 56, 57, 58, 59 | Зарезервовано | &nbsp; | &nbsp; | &nbsp; | &nbsp; | &nbsp; |

!!! warning "Зверніть увагу!"

    - У разі модифікації бітрейту в мережі RS-485, нова швидкість набуває чинності негайно. 
    - У разі модифікації Modbus ID адреси перетворювача, нова адреса набуває чинності негайно.  

!!! danger "Діапазон дозволених адресів регістрів та даних"

    - При спробі читання та/або запису даних поза межами вказаного вище в таблицях адресного простору - повертається помилка.
    - При спробі запису даних поза межами вказаного вище в таблицях дозволеного діапазону - повертається помилка.

!!! info "Про зарезервовані регістри"

    - Регістри по адресам 17, 18, 19, 20, 21, 32, 33, 34, 35, 36, 46, 47, 48, 49, 50, 55, 56, 57, 58, 59 зарезервовані на випадок додавання параметрів в адресний простір в майбутньому.
    - При читанні повертається нуль.
    - Після запису дані не зберігаються.

## Алгоритм налаштування режиму роботи через ModBus { #algoritm-stabilizacii data-toc-label='Алгоритм налаштування режиму роботи' }    

Алгоритм налаштування стабілізації струму, напруги або потенціалу віддалено через ModBus.

<h1>Увага! Цей розділ в процесі наповнення!</h1>